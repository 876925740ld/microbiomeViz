gtr = p
gtr + geom_text2(aes(subset=(node %in% hnodes), label=label))
for(i in hnodes){
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1)
}
gtr + geom_text2(aes(subset=(node %in% hnodes), label=label))
gtr + geom_text2(aes(subset=(node %in% hnodes), label=label, vjust=10))
gtr + geom_text2(aes(subset=(node %in% hnodes), label=label, vjust=-10))
gtr + geom_text2(aes(subset=(node %in% hnodes), label=label, vjust=-5))
gtr + geom_text2(aes(subset=(node %in% hnodes, vjust=2), label=label))
gtr + geom_cladelabel(node=1, label="test label")
gtr + geom_cladelabel(node=i, label="test label")
?geom_cladelabel
gtr + geom_cladelabel(node=i, label="test label", extend = 1)
gtr + geom_cladelabel(node=i, label="test label", offset = 1)
gtr + geom_cladelabel(node=i, label="test label", offset = 1 ,barsize = 0)
gtr + geom_cladelabel(node=i, label=label, offset = 1 ,barsize = 0)
gtr + geom_cladelabel(node=i, aes(label=label), offset = 1 ,barsize = 0)
gtr + geom_cladelabel(node=i, label=I(label), offset = 1 ,barsize = 0)
gtr$data
gtr$data$label
lab <- gtr$data %>% filter(label == i)
lab
i
lab <- gtr$data %>% filter(node == i)
lab
lab <- (gtr$data %>% filter(node == i))$node
lab
lab <- (gtr$data %>% filter(node == i))$label
gtr
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(node=i, label=lab, offset = 1 ,barsize = 0)
}
gtr
gtr=p
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(node=i, label=lab, offset = 1 ,barsize = 0, hjust=0.5)
}
gtr
gtr <- p
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(aes(angle=angle),
node=i, label=lab, offset = 1 ,barsize = 0, hjust=0.5)
}
gtr <- p
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(angle=angle,
node=i, label=lab, offset = 1 ,barsize = 0, hjust=0.5)
}
?geom_cladelabel2
?geom_cladelabel
?geom_cladelabel2
gtr <- p
gtr <- p
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel2(
node=i, label=lab, offset = 1 ,barsize = 0, hjust=0.5)
}
gtr
gtr <- p
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(
node=i, label=lab, offset = 1 ,barsize = 0, hjust=0.5)
}
gtr
?geom_cladelabel
gtr <- p
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(aes(angle=angle),
node=i, label=lab, offset = 1 ,barsize = 0, hjust=0.5)
}
gtr <- p
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(aes(angle=angle),
node=i, label=lab, #offset = 1 ,
barsize = 0, hjust=0.5)
}
gtr <- p
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(aes(angle=angle), offset.text = 1,
node=i, label=lab, offset = 1 ,
barsize = 0, hjust=0.5)
}
p
gtr
gtr <- p
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(aes(angle=angle), #offset.text = 1,
node=i, label=lab,# offset = 1 ,
barsize = 0, hjust=0)
}
(gtr$data %>% filter(node == i))$label
(gtr$data %>% filter(node == i))$angle
gtr <- p
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
angle <- (gtr$data %>% filter(node == i))$angle
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(angle=angle, #offset.text = 1,
node=i, label=lab,# offset = 1 ,
barsize = 0, hjust=0)
}
gtr
hnodes <- (gtr$data %>% filter(label %in% node_list ))$node
gtr <- p
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
angle <- (gtr$data %>% filter(node == i))$angle
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(angle=angle+90, #offset.text = 1,
node=i, label=lab,# offset = 1 ,
barsize = 0, hjust=0)
}
gtr
gtr <- p
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
angle <- (gtr$data %>% filter(node == i))$angle
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(angle=angle-90, offset.text = 1,
node=i, label=lab, offset = 1 ,
barsize = 0, hjust=0)
}
gtr
gtr <- p
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
angle <- (gtr$data %>% filter(node == i))$angle
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(angle=angle-90,
node=i, label=lab, offset = 1 ,
barsize = 0, hjust=0.5)
}
gtr
geom_text2
geom_tiplab2()
geom_tiplab2
gtr <- p
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
angle <- (gtr$data %>% filter(node == i))$angle
angle <- ifelse((angle >= 90 & angle <= 270), angle+180, angle)
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(angle=angle-90,
node=i, label=lab, offset = 1 ,
barsize = 0, hjust=0.5)
}
gtr
gtr <- p
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
angle <- (gtr$data %>% filter(node == i))$angle
angle <- ifelse((angle >= 90 & angle <= 270), angle+180, angle)
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(angle=angle,
node=i, label=lab, offset = 1 ,
barsize = 0, hjust=0.5)
}
gtr
gtr <- p
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
angle <- (gtr$data %>% filter(node == i))$angle
angle <- ifelse((angle >= 90 & angle <= 270), angle+90, angle-90)
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(angle=angle,
node=i, label=lab, offset = 1 ,
barsize = 0, hjust=0.5)
}
gtr
clade.anno <- function(gtr, nodes, hilight.color='red'){
hnodes <- (gtr$data %>% filter(label %in% node_list ))$node
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
angle <- (gtr$data %>% filter(node == i))$angle
angle <- ifelse((angle >= 90 & angle <= 270), angle+90, angle-90)
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(angle=angle,
node=i, label=lab, offset = 1 ,
barsize = 0, hjust=0.5)
}
gtr
}
gtr$data
node_list <- c("g__Roseburia", "c__Clostridia", "s__Bacteroides_ovatus")
clade.anno(p, node_list)
clade.anno <- function(gtr, nodes, hilight.color='red'){
hnodes <- (gtr$data %>% filter(label %in% node_list ))$node
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
angle <- (gtr$data %>% filter(node == i))$angle -90
#angle <-
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(angle=angle,
node=i, label=lab, offset = 1 ,
barsize = 0, hjust=0.5)
}
gtr
}
clade.anno(p, node_list)
i = node_list[3]
i
angle <- (gtr$data %>% filter(node == i))$angle# -90
angle
gtr$data
i
i =22
angle <- (gtr$data %>% filter(node == i))$angle# -90
angle
clade.anno <- function(gtr, nodes, hilight.color='red'){
hnodes <- (gtr$data %>% filter(label %in% node_list ))$node
for(i in hnodes){
lab <- (gtr$data %>% filter(node == i))$label
angle <- (gtr$data %>% filter(node == i))$angle
angle <- ifelse(angle>180, angle+90, angle-90)
gtr <-
gtr + geom_hilight(node=i, fill = hilight.color, alpha = 0.3, extend = 1) +
geom_cladelabel(angle=angle,
node=i, label=lab, offset = 1 ,
barsize = 0, hjust=0.5)
}
gtr
}
clade.anno(p, node_list)
##' @param gtree a ggtree object
##' @param anno.data a 2 column data.frame of annotation information. It has columns of clade name and color used for highlighting.
##' @return a ggtree object
##' @importFrom treeio treedata
##' @importFrom magrittr "%>%"
##' @import ggtree
##' @import dplyr
##' @author Chenhao Li, Guangchuang Yu
##' @export
##' @description annotate a ggtree plot to highlight certain clades
clade.anno <- function(gtree, anno.data){
hilight.color <- anno.data$color
node_list <- anno.data$node
node_ids <- (gtree$data %>% filter(label %in% node_list ))$node
for(i in 1:length(hnodes)){
node <- node_ids[i]
mapping <- gtree$data %>% filter(node == node)
lab <- mapping$label
angle <- mapping$angle
angle <- ifelse(angle>180, angle+90, angle-90)
gtree <-
gtree + geom_hilight(node=node, fill=hilight.color, alpha=0.3, extend=1) +
geom_cladelabel(angle=angle, node=node, label=lab,
offset=1, barsize=0, hjust=0.5)
}
gtree
}
gtr
anno.dat <- data.frame(node=c("g__Roseburia", "c__Clostridia", "s__Bacteroides_ovatus"),
color='red')
clade.anno(p, anno.dat)
anno.data <- data.frame(node=c("g__Roseburia", "c__Clostridia", "s__Bacteroides_ovatus"),
color='red')
anno.data
gtree= p
hilight.color <- anno.data$color
p
hilight.color
anno.data <- data.frame(node=c("g__Roseburia", "c__Clostridia", "s__Bacteroides_ovatus"),
color='red', stringsAsFactors = FALSE)
hilight.color <- anno.data$color
node_list <- anno.data$node
node_list
node_ids <- (gtree$data %>% filter(label %in% node_list ))$node
node_ids
for(i in 1:length(node_ids)){
node <- node_ids[i]
mapping <- gtree$data %>% filter(node == node)
lab <- mapping$label
angle <- mapping$angle
angle <- ifelse(angle>180, angle+90, angle-90)
gtree <-
gtree + geom_hilight(node=node, fill=hilight.color, alpha=0.3, extend=1) +
geom_cladelabel(angle=angle, node=node, label=lab,
offset=1, barsize=0, hjust=0.5)
}
gtree
i
node <- node_ids[i]
node
gtree=p
mapping <- gtree$data %>% filter(node == node)
mapping
node
mapping <- gtree$data %>% filter(node == 13)
node
mapping
node
mapping <- gtree$data %>% filter(node == n)
n <- node_ids[i]
mapping <- gtree$data %>% filter(node == n)
mapping
lab <- mapping$label
angle <- mapping$angle
angle <- ifelse(angle>180, angle+90, angle-90)
gtree <-
gtree + geom_hilight(node=n, fill=hilight.color, alpha=0.3, extend=1) +
geom_cladelabel(angle=angle, node=n, label=lab,
offset=1, barsize=0, hjust=0.5)
gtree
gtree <-
gtree + geom_hilight(node=n, fill=hilight.color, alpha=0.3, extend=1) #+
gtree
gtree = p
#gtree <-
gtree + geom_hilight(node=n, fill=hilight.color, alpha=0.3, extend=1) #+
node
n
hilight.color
n <- node_ids[i]
color <- hilight.color[i]
mapping <- gtree$data %>% filter(node == n)
lab <- mapping$label
angle <- mapping$angle
angle <- ifelse(angle>180, angle+90, angle-90)
#gtree <-
gtree + geom_hilight(node=n, fill=color, alpha=0.3, extend=1) #+
#gtree <-
gtree + geom_hilight(node=n, fill=color, alpha=0.3, extend=1) +
geom_cladelabel(angle=angle, node=n, label=lab,
offset=1, barsize=0, hjust=0.5)
##' @param gtree a ggtree object
##' @param anno.data a 2 column data.frame of annotation information. It has columns of clade name and color used for highlighting.
##' @return a ggtree object
##' @importFrom treeio treedata
##' @importFrom magrittr "%>%"
##' @import ggtree
##' @import dplyr
##' @author Chenhao Li, Guangchuang Yu
##' @export
##' @description annotate a ggtree plot to highlight certain clades
clade.anno <- function(gtree, anno.data){
hilight.color <- anno.data$color
node_list <- anno.data$node
node_ids <- (gtree$data %>% filter(label %in% node_list ))$node
for(i in 1:length(node_ids)){
n <- node_ids[i]
color <- hilight.color[i]
mapping <- gtree$data %>% filter(node == n)
lab <- mapping$label
angle <- mapping$angle
angle <- ifelse(angle>180, angle+90, angle-90)
#gtree <-
gtree + geom_hilight(node=n, fill=color, alpha=0.3, extend=1) +
geom_cladelabel(angle=angle, node=n, label=lab,
offset=1, barsize=0, hjust=0.5)
}
gtree
}
clade.anno(p, anno.data)
hilight.color <- anno.data$color
node_list <- anno.data$node
node_ids <- (gtree$data %>% filter(label %in% node_list ))$node
for(i in 1:length(node_ids)){
n <- node_ids[i]
color <- hilight.color[i]
mapping <- gtree$data %>% filter(node == n)
lab <- mapping$label
angle <- mapping$angle
angle <- ifelse(angle>180, angle+90, angle-90)
#gtree <-
gtree + geom_hilight(node=n, fill=color, alpha=0.3, extend=1) +
geom_cladelabel(angle=angle, node=n, label=lab,
offset=1, barsize=0, hjust=0.5)
}
gtree
##' @param gtree a ggtree object
##' @param anno.data a 2 column data.frame of annotation information. It has columns of clade name and color used for highlighting.
##' @return a ggtree object
##' @importFrom treeio treedata
##' @importFrom magrittr "%>%"
##' @import ggtree
##' @import dplyr
##' @author Chenhao Li, Guangchuang Yu
##' @export
##' @description annotate a ggtree plot to highlight certain clades
clade.anno <- function(gtree, anno.data){
hilight.color <- anno.data$color
node_list <- anno.data$node
node_ids <- (gtree$data %>% filter(label %in% node_list ))$node
for(i in 1:length(node_ids)){
n <- node_ids[i]
color <- hilight.color[i]
mapping <- gtree$data %>% filter(node == n)
lab <- mapping$label
angle <- mapping$angle
angle <- ifelse(angle>180, angle+90, angle-90)
gtree <-
gtree + geom_hilight(node=n, fill=color, alpha=0.3, extend=1) +
geom_cladelabel(angle=angle, node=n, label=lab,
offset=1, barsize=0, hjust=0.5)
}
gtree
}
clade.anno(p, anno.data)
devtools::document()
library(microbiomeViz)
library(microbiomeViz)
devtools::document()
library(microbiomeViz)
data("SRS014459_Stool_profile")
tr <- parseMetaphlanTSV(SRS014459_Stool_profile)
p <- ggtree(tr, size=2, layout = 'circular')  +
geom_point(aes(size=I(nodeSize)), shape=21, fill='white')
p
anno.data <- data.frame(node=c("g__Roseburia", "c__Clostridia", "s__Bacteroides_ovatus"),
color='red', stringsAsFactors = FALSE)
clade.anno(p, anno.data)
devtools::document()
library(microbiomeViz)
data("SRS014459_Stool_profile")
tr <- parseMetaphlanTSV(SRS014459_Stool_profile)
plot.tree(tr)
library(microbiomeViz)
?plot.tree
data("SRS014459_Stool_profile")
tr <- parseMetaphlanTSV(SRS014459_Stool_profile)
plot.tree(tr)
plot(tr)
devtools::document()
library(microbiomeViz)
devtools::document()
library(microbiomeViz)
tr <- parseMetaphlanTSV(SRS014459_Stool_profile)
tree.backbone(tr)
t <- tree.backbone(tr)
clade.anno(p, anno.data)
devtools::document()
knitr::opts_chunk$set(echo = TRUE)
data("SRS014459_Stool_profile")
tr <- parseMetaphlanTSV(SRS014459_Stool_profile)
library(microbiomeViz)
knitr::opts_chunk$set(echo = TRUE)
library(microbiomeViz)
data("SRS014459_Stool_profile")
tr <- parseMetaphlanTSV(SRS014459_Stool_profile)
p <- tree.backbone(tr)
p
anno.data <- data.frame(node=c("g__Roseburia", "c__Clostridia", "s__Bacteroides_ovatus"),
color='red', stringsAsFactors = FALSE)
p <- clade.anno(p, anno.data)
p
?read.ftable
?read.table
devtools::document()
devtools::build()
Sys.getenv("TZ")
Sys.setenv(TZ="Singapore/Singapore")
Sys.getenv("TZ")
library(microbiomeViz)
Sys.setenv(TZ="China/Beijing")
library(microbiomeViz)
Sys.setenv(TZ="Asia/Singapore")
library(microbiomeViz)
devtools::document()
library(microbiomeViz)
devtools::install_github('lch14forever/microbiomeViz')
library(ggtree)
devtools::build()
devtools::build()
devtools::build()
library(treeio)
sessionInfo()
?ggtree
?treeio
?treeio
devtools::build()
library(microbiomeViz)
